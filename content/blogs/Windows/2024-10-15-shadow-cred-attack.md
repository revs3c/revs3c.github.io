---
layout: default
title:  "Shadow Cred Attack"
type: docs
---

## 🎯 Intro: What Is the Shadow Credentials Attack?   

The **Shadow Credentials attack** is a stealthy and persistent Active Directory exploitation technique that leverages misconfigurations or excessive permissions in AD environments—specifically, the ability to write to the `msDS-KeyCredentialLink` attribute of a user or computer account. By injecting a custom certificate (public key) into this attribute, an attacker can authenticate as the target account using PKINIT (Kerberos certificate-based authentication), without needing the account’s password or NTLM hash. This method grants unauthorized, often persistent, access and can be used for lateral movement, privilege escalation, or maintaining a backdoor in the domain   
   
## 🔐 Requirements for Shadow Credentials   

| Requirement                                                       | Description                                                            |
| :---------------------------------------------------------------- | :--------------------------------------------------------------------- |
| ✅ GenericWrite / GenericAll / WriteProperty                       | On the target user object (visible in BloodHound)                      |
| ✅ Certificate Authority (CA)                                      | Enterprise CA deployed in the domain (often already exists)            |
| ✅ ADCS PKINIT support                                             | Domain must allow Kerberos PKINIT authentication (most modern ones do) |
| ✅ Tools like Certify, ForgeCert, PKINITtools, Impacket, or Rubeus | For crafting certs, inserting KeyCredentials, and getting TGTs         |
| ✅ Time synchronization                                            | Your system’s clock must match the domain's to use Kerberos properly   |


There are numerious methods to do this attacks but we will be looking at the bloodyAD method   
   

### bloodyAD —host 10.10.11.69 -d fluffy.htb -u 'p.agila' -p 'prometheusx-303' add shadowCredentials WINRM\_SVC   

![image](image.png)    

> Purpose:-   
> **What this command does:**   
	- **Connects to the domain controller** at `10.10.11.69` in the `fluffy.htb` domain using the credentials for user `p.agila` and password `prometheusx-303`.   
	- **Targets the account** named `WINRM\_SVC`.   
	- **Performs the "add shadowCredentials" action**:
		This injects a new "key credential" (a public key certificate generated by bloodyAD) into the `msDS-KeyCredentialLink` attribute of the `WINRM\_SVC` account in Active Directory [1](https://github.com/CravateRouge/bloodyAD/wiki/User-Guide) [2](https://www.hackingarticles.in/shadow-credentials-attack/) [3](https://swisskyrepo.github.io/InternalAllTheThings/active-directory/pwd-shadow-credentials/)

   
## Step-by-Step Explanation

1. **Authentication:**
		bloodyAD authenticates to the domain controller using the provided username and password.   
2. **Key Generation:**
		The tool generates a new RSA key pair (private and public key).   
3. **Public Key Injection:**
		The public key (as a certificate) is added to the `msDS-KeyCredentialLink` attribute of the `WINRM\_SVC` account.
		This essentially registers the attacker's key as a valid authentication method for that account [2](https://www.hackingarticles.in/shadow-credentials-attack/) [3](https://swisskyrepo.github.io/InternalAllTheThings/active-directory/pwd-shadow-credentials/).   
4. **File Output:**
		The tool saves the generated certificate and private key to files in your working directory.   
5. **Result:**
		The attacker (you) can now use the matching private key and certificate to authenticate as `WINRM\_SVC` via Kerberos PKINIT, without needing the account’s password or hash. This allows you to obtain a Kerberos Ticket Granting Ticket (TGT) as `WINRM\_SVC` and act as that user in the domain [2](https://www.hackingarticles.in/shadow-credentials-attack/) [3](https://swisskyrepo.github.io/InternalAllTheThings/active-directory/pwd-shadow-credentials/).   
   
   
### python3 PKINITtools/gettgtpkinit.py -cert-pem p9TMZZUJ\_cert.pem -key-pem p9TMZZUJ\_priv.pem fluffy.htb/WINRM\_SVC p9TMZZUJ.ccache   
   
> Purpose:- Utilize **[PKINITOOLS](https://github.com/dirkjanm/PKINITtools)**  to obtain a Kerberos TGT (ticket-granting-ticket) for the machine account   
   
![Screenshot From 2025-07-01 20-56-51](screenshot-from-2025-07-01-20-56-51.png)    
### export KRB5CCNAME=p9TMZZUJ.ccache   

> Purpose:- The `export` command is used to **set an environment variable** for your current shell session — and in this context, it tells **Kerberos-aware tools** (like Impacket) **which TGT (ticket) to use**. 

### python3 PKINITtools/getnthash.py -key 18c6a4e6c59f9ed5e739921d04e5602289c4de4a0e0b4768938a2e31fc8d0a3a fluffy.htb/WINRM\_SVC   

> Purpose:- Utilize getnthash.py to retrieve the machine account’s NTLM hash   
   
![Screenshot From 2025-07-01 20-58-24](screenshot-from-2025-07-01-20-58-24.png)    
   
